<h2 id="switch-name">{{ switch.name }}</h2>
<p><b>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</b> <span id="switch-location">{{ switch.placement }}</span></p>
<p><b>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä:</b> <span id="switch-serial">{{ switch.serialNum }}</span></p>
<p><b>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–π –Ω–æ–º–µ—Ä:</b> <span id="switch-inventory">{{ switch.inventoryNum }}</span></p>
<p><b>MAC-–∞–¥—Ä–µ—Å:</b> <span id="switch-mac">{{ switch.macAddr }}</span></p>
<p><b>IP-–∞–¥—Ä–µ—Å:</b> <span id="switch-ip">{{ switch.ip_address }}</span></p>
<p><b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä—Ç–æ–≤:</b> <span id="switch-ports">{{ switch.ports_count }}</span></p>

<form id="ports-form">
    {% csrf_token %}
    <input type="hidden" name="switch_id" value="{{ switch.id }}">
    <button type="button" id="edit-btn" style="font-size: 12pt; padding: 4px 6px;background: linear-gradient(to top left, #ffffff 0%, #99ccff 100%);">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
    <button type="button" id="save-btn" style="font-size: 12pt; padding: 4px 6px; background: linear-gradient(to top left, #ffffff 0%, #99ccff 100%)" disabled>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <a href="{% url 'export_switch_excel' switch.id %}"
   class="btn"
   style="font-size: 12pt; padding: 4px 6px; text-decoration:none; color: black; border:solid 1px; background: linear-gradient(to top left, #ffffff 0%, #99ccff 100%)">
    üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
</a>
    <select id="port-filter" style="font-size: 13pt; padding: 4.5px 6px; margin-left:5px;" class="no-disable">
        <option value="all">–í—Å–µ</option>
        <option value="free">–°–Ω–∞—á–∞–ª–∞ —Å–≤–æ–±–æ–¥–Ω—ã–µ</option>
        <option value="used">–°–Ω–∞—á–∞–ª–∞ –∑–∞–Ω—è—Ç—ã–µ</option>
    </select>
    <table id="ports-table">
        <thead>
            <tr>
                <th style="background: linear-gradient(to bottom, #ffffff 0%, #99ccff 100%);">‚Ññ</th>
                <th style="background: linear-gradient(to bottom, #ffffff 0%, #99ccff 100%);">–ü–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th>
                <th style="background: linear-gradient(to bottom, #ffffff 0%, #99ccff 100%);">IP-–∞–¥—Ä–µ—Å</th>
                <th style="background: linear-gradient(to bottom, #ffffff 0%, #99ccff 100%);">–ò–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</th>
                <th style="background: linear-gradient(to bottom, #ffffff 0%, #99ccff 100%);">–¢–∏–ø –ø–æ—Ä—Ç–∞</th>
                <th style="background: linear-gradient(to bottom, #ffffff 0%, #99ccff 100%);">–°—Ç–∞—Ç—É—Å</th>
                <th style="background: linear-gradient(to bottom, #ffffff 0%, #99ccff 100%);">VLAN</th>
                <th style="background: linear-gradient(to bottom, #ffffff 0%, #99ccff 100%);">Up Link</th>
                <th style="background: linear-gradient(to bottom, #ffffff 0%, #99ccff 100%);" >–î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</th>
                <th style="background: linear-gradient(to bottom, #ffffff 0%, #99ccff 100%);">–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ</th>
            </tr>
        </thead>
        <tbody>
            {% for port in ports %}
            <tr>
                <td>{{ port.number }}</td>
                <td><input type="text" name="connected_device_{{ port.id }}" value="{{ port.connected_device|default:'' }}" disabled></td>
                <td><input type="text" name="ip_address_{{ port.id }}" value="{{ port.ip_address|default:'' }}" disabled></td>
                <td><input type="text" name="device_name_{{ port.id }}" value="{{ port.device_name|default:'' }}" disabled></td>
                <td>
                    <select name="portType_{{ port.id }}" disabled>
                        {% for value, label in port_type_choices.items %}
                            <option value="{{ value }}" {% if port.portType == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td>
                    <select name="status_{{ port.id }}" disabled>
                        {% for value, label in status_choices.items %}
                            <option value="{{ value }}" {% if port.status == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td><input type="text" name="vlanNum_{{ port.id }}" value="{{ port.vlanNum|default:'' }}" disabled></td>
                <td><input type="text" name="upLink_{{ port.id }}" value="{{ port.upLink|default:'' }}" disabled></td>
                <td><input type="text" name="addInfo_{{ port.id }}" value="{{ port.addInfo|default:'' }}" disabled></td>
                <td><input type="text" name="cabPlacement_{{ port.id }}" value="{{ port.cabPlacement|default:'' }}" disabled></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É SheetJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
document.getElementById("export-btn").addEventListener("click", function () {
    let wb = XLSX.utils.book_new();

    // 1. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–µ
    let switchInfo = [
        ["–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–∞:", "{{ switch.name }}"],
        ["–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:", "{{ switch.placement }}"],
        ["–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä:", "{{ switch.serialNum }}"],
        ["–ò–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–π –Ω–æ–º–µ—Ä:", "{{ switch.inventoryNum }}"],
        ["MAC-–ê–¥—Ä–µ—Å:", "{{ switch.macAddr }}"],
        ["IP-–∞–¥—Ä–µ—Å:", "{{ switch.ip_address }}"],
        ["–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä—Ç–æ–≤:", "{{ switch.ports_count }}"]
    ];
    let ws = XLSX.utils.aoa_to_sheet(switchInfo);

    // 2. –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
    XLSX.utils.sheet_add_aoa(ws, [[]], { origin: -1 });

    // 3. –¢–∞–±–ª–∏—Ü–∞ –ø–æ—Ä—Ç–æ–≤
    let table = document.getElementById("ports-table");
    let ws_ports = XLSX.utils.table_to_sheet(table);

    // 4. –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–æ—Ä—Ç–æ–≤ —Å –∏–Ω—Ñ–æ –æ –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–µ
    XLSX.utils.sheet_add_json(ws, XLSX.utils.sheet_to_json(ws_ports, {header:1}), {origin:-1});

    // 5. –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç –≤ –∫–Ω–∏–≥—É
    XLSX.utils.book_append_sheet(wb, ws, "–ö–æ–º–º—É—Ç–∞—Ç–æ—Ä");

    // 6. –°–æ—Ö—Ä–∞–Ω—è–µ–º
    XLSX.writeFile(wb, "switch_ports.xlsx");
});
</script>
</form>
